---
description: Archiving the Web, because nothing lasts forever - pulling together all the previous archive tools.
tags: Haskell, archiving
created: 10 Mar 2011
status: finished
belief: highly likely
...

> "Decay is inherent in all compound things. Work out your own salvation with diligence." --Last words of the Buddha.

Given my interest in [long term content](About#long-content) and extensive linking, [link rot](!Wikipedia) is an issue of deep concern to me. I need backups not just for my files[^backups], but for the web pages I read and use - they're all part of my [exomind](!Wikipedia). It's not much good to have an extensive essay on some topic where half the links are dead and the reader can neither verify my claims nor get context for my claims.

[^backups]: I use [`duplicity`](http://duplicity.nongnu.org/) & [`rdiff-backup`](http://www.nongnu.org/rdiff-backup/) to backup my entire home directory to a cheap 1.5TB hard drive (bought from Newegg using <http://forre.st/storage#hdd>); a limited selection of folders are backed up to [Tarsnap](http://www.tarsnap.com/).

    I used to semiannually tar up my important folders, add [PAR2](!Wikipedia) redundancy, and burn them to DVD, but that's no longer really feasible; if I ever get a Blu-ray burner, I'll resume WORM backups. (Magnetic media doesn't strike me as reliable over many decades, and it would ease my mind to have optical backups.)

The statistics are dismal. To quote [Wikipedia](!Wikipedia "Link rot#Prevalence"):

> In a 2003 experiment, [Fetterly et al.](http://www2003.org/cdrom/papers/refereed/p097/P97%20sources/p97-fetterly.html) discovered that about one link out of every 200 disappeared each week from the Internet. [McCown et al. (2005)](http://iwaw.europarchive.org/05/papers/iwaw05-mccown1.pdf) discovered that half of the URLs cited in [D-Lib Magazine](!Wikipedia) articles were no longer accessible 10 years after publication [the irony!], and other studies have shown link rot in academic literature to be even worse ([Spinellis, 2003](http://www.spinellis.gr/pubs/jrnl/2003-CACM-URLcite/html/urlcite.html), [Lawrence et al., 2001](http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.97.9695&rep=rep1&type=pdf)). [Nelson and Allen (2002)](http://www.dlib.org/dlib/january02/nelson/01nelson.html) examined link rot in digital libraries and found that about 3% of the objects were no longer accessible after one year.

[Bruce Schneier](!Wikipedia) remarks that one friend experienced 50% linkrot in one of his pages over less than 9 years (not that the situation was any better [in 1998](http://www.pantos.org/atw/35654.html)), and that his own blog posts link to news articles that go dead in days[^Schneier]; the [Internet Archive](!Wikipedia) has estimated the average lifespan of a Web page at [100 days](http://www.wired.com/culture/lifestyle/news/2001/10/47894). A _[Science](!Wikipedia "Science (journal)")_ study looked at articles in prestigious journals; they didn't use many Internet links, but when they did, 2 years later ~13% were dead[^science]. The French company Linterweb studied external links on the [French Wikipedia](!Wikipedia) before setting up [their cache](http://www.wikiwix.com/) of French external links, and found - back in 2008 - already [5% were dead](http://fr.wikipedia.org/wiki/Utilisateur:Pmartin/Cache). (The English Wikipedia has seen a 2010-2011 spike from a few thousand dead links to [~110,000](!Wikipedia "File:Articles-w-Dead-Links-Jan-2011.png") out of [~17.5m live links](!Wikipedia "Wikipedia talk:WikiProject External links/Webcitebot2#Summary").)  The dismal studies [just](http://jnci.oxfordjournals.org/content/96/12/969.full) [go](/docs/2007-dimitrova.pdf) [on](/docs/2008-wren.pdf) [and](http://archderm.ama-assn.org/cgi/reprint/142/9/1147.pdf) [on](http://www.ncbi.nlm.nih.gov/pmc/articles/PMC2213465/) [and](http://jama.ama-assn.org/content/292/22/2723.3.full) [on](http://www.fasebj.org/content/19/14/1943.full) ([and on](http://www.srlst.com/ijist/V8N2/ijism-V8N2_files/ijism82-57-74.pdf)). Even in a highly stable, funded, curated environment, link rot happens anyway. For example, about [11% of Arab Spring-related tweets](http://arxiv.org/pdf/1209.3026v1.pdf "'Losing My Revolution: How Many Resources Shared on Social Media Have Been Lost?', SalahEldeen & Nelson 2012") were gone within a year (even though Twitter is - currently - still around).

[^science]: ["Going, Going, Gone: Lost Internet References"](http://scimaps.org/exhibit/docs/dellawalle.pdf); abstract:

    > The extent of Internet referencing and Internet reference activity in medical or scientific publications was systematically examined in more than 1000 articles published between 2000 and 2003 in the New England Journal of Medicine, The Journal of the American Medical Association, and Science. Internet references accounted for 2.6% of all references (672/25548) and in articles 27 months old, 13% of Internet references were inactive.
[^Schneier]: ["When the Internet Is My Hard Drive, Should I Trust Third Parties?"](http://www.wired.com/politics/security/commentary/securitymatters/2008/02/securitymatters_0221), _Wired_:

    > Bits and pieces of the web disappear all the time. It's called 'link rot', and we're all used to it. A friend saved 65 links in 1999 when he planned a trip to Tuscany; only half of them still work today. In my own blog, essays and news articles and websites that I link to regularly disappear -- sometimes within a few days of my linking to them.

My specific target date is 2070, 60 years from now. As of 10 March 2011, `gwern.net` has around 6800 external links (with around 2200 to non-Wikipedia websites). Even at the very lowest estimate of 3% annual linkrot, few will survive to 2070. If each link has a 97% chance of surviving each year, then the chance a link will be alive in 2070 is $0.97^{2070-2011} = ~0.17$ or just 17%, or to put it another way, an 83% chance any given link *will* die. The 95% [confidence interval](!Wikipedia) for the [Poisson distribution](!Wikipedia) says that of the 2200 non-Wikipedia links, ~338-409 will survive to 2070. If we try to predict using a more reasonable estimate of 50% linkrot, then approximately 0 links will survive ($0.50^{2070-2011} = 1.73472348 \times 10^{-16} \simeq 0$). It would be a good idea to simply assume that *no* link will survive.

With that in mind, one can consider remedies. (If we lie to ourselves and say it won't be a problem in the future, then we guarantee that it *will* be a problem. ["People can stand what is true, for they are already enduring it."](http://wiki.lesswrong.com/wiki/Litany_of_Gendlin))

# Detection

> With every new spring \
> the blossoms speak not a word \
> yet expound the Law -- \
> knowing what is at its heart \
> by the scattering storm winds.^[Shōtetsu; 101, 'Buddhism related to Blossoms'; _Unforgotten Dreams: Poems by the Zen monk Shōtetsu_; trans. Steven D. Carter, ISBN 0-231-10576-2]

The first and most obvious remedy is to learn about broken links as soon as they happen, which allows one to react quickly and scrape archives or search engine caches (['lazy preservation'](http://www.cs.odu.edu/~fmccown/research/lazy/)). I currently use [`linkchecker`](http://linkchecker.sourceforge.net/) to spider gwern.net looking for broken links. `linkchecker` is run in a [cron](!Wikipedia) job like so:

~~~{.bash}
@monthly linkchecker www.gwern.net --ignore-url=^mailto --ignore-url=^irc --anchors --timeout=1200 --threads=20 --file-output=html
~~~

Just this command would turn up many false positives. For example, there would be several hundred warnings on Wikipedia links because I link to redirects; and `linkchecker` respects [robots.txt](!Wikipedia)s which forbid it to check liveness, but emits a warning about this. These can be suppressed by editing `~/.linkchecker/linkcheckerrc` to say `ignorewarnings=http-moved-permanent,http-robots-denied` (the available warning classes are listed in `linkchecker -h`).

The quicker you know about a dead link, the sooner you can look for replacements or its new home.

# Prevention
## Local caching

On a roughly monthly basis, I run a shell script named, imaginatively enough, `local-archiver`:

~~~{.bash}
#!/bin/sh
set -e

cp `find ~/.mozilla/ -name "places.sqlite"` ~/
sqlite3 places.sqlite "SELECT url FROM moz_places, moz_historyvisits \
                       WHERE moz_places.id = moz_historyvisits.place_id and visit_date > strftime('%s','now','-1.5 month')*1000000 ORDER by \
                       visit_date;" | filter-urls >> ~/.tmp
rm ~/places.sqlite
split -l500 ~/.tmp ~/.tmp-urls
rm ~/.tmp

cd ~/www/
for file in ~/.tmp-urls*;
 do (wget --continue --page-requisites --timestamping --input-file $file && rm $file &);
done

find ~/www -size +4M -delete
~~~

The code is not the prettiest, but it's fairly straightforward:

- the script grabs my Firefox browsing history by extracting it from the history SQL database file^[Much easier than it was in the past; [Jamie Zawinski](!Wikipedia) records his travails with the *previous* Mozilla history format in the aptly-named ["when the database worms eat into your brain"](http://www.jwz.org/blog/2004/03/when-the-database-worms-eat-into-your-brain/).], and feeds the URLs into [wget](!Wikipedia)
- The script `split`s the long list of URLs into a bunch of files and runs that many `wget`s because `wget` apparently has no way of simultaneously downloading from multiple domains.
- The [`filter-urls`](#filter-urls) command is another shell script, which removes URLs I don't want archived. This script is a hack which looks like this:

    ~~~{.bash}
    #!/bin/sh
    set -e
    cat /dev/stdin | sed -e "s/#.*//" | sed -e "s/&sid=.*$//" | sed -e "s/\/$//" | grep -v -e 4chan -e reddit ...
    ~~~

A local copy is not the best resource - what if a link goes dead in a way your tool cannot detect so you don't *know* to put up your copy somewhere? But it solves the problem pretty decisively.

The space consumed by such a backup is not that bad; only 30-50 gigabytes for a year of browsing, and less depending on how hard you prune the downloads. (More, of course, if you use `linkchecker` to archive entire sites and not just the pages you visit.) Storing this is quite viable in the long term; while page sizes have [increased 7x](http://www.websiteoptimization.com/speed/tweak/average-web-page/) between 2003 and 2011 and pages average around 400kb^[An older [2010 Google article](https://code.google.com/speed/articles/web-metrics.html) put the average at 320kb, but that was an average over the entire Web, including all the old content.], [Kryder's law](!Wikipedia) has also been operating and has increased disk capacity by ~128x - in 2011, \$80 will buy you at least [2 terabytes](http://forre.st/storage#hdd), that works out to 4 cents a gigabyte or 80 cents for the low estimate for downloads; that is much better than the $25 annual fee that somewhere like [Pinboard](http://pinboard.in/upgrade/) charges. Of course, you need to back this up yourself. We're relatively fortunate here - most Internet documents are 'born digital' and easy to migrate to new formats or inspect in the future. We can basically just download them and worry about how to view them only when we need a particular document, and Web browser backwards-compatibility already stretches back to files written in the early 1990s. (Of course, we're probably screwed if we discover the content we wanted was presented only in Adobe Flash or as an inaccessible 'cloud' service.) In contrast, if we were trying to preserve programs or software libraries instead, we would face a much more formidable task in keeping a working ladder of binary-compatible virtual machines or interpreters^[Already one runs classic [LucasArts adventure games](!Wikipedia) and whatnot in emulators like [DOSBox](!Wikipedia); but those emulators will not always be maintained. Who will emulate the emulators? Well, presumably one will in 2050 instead emulate on one's laptop some ancient but compatible OS - Windows 7 or Debian 6.0, perhaps - and inside *that* run DOSBox (to run the game).]. The situation with [digital movie preservation](http://www.davidbordwell.net/blog/2012/02/13/pandoras-digital-box-pix-and-pixels/ "Pandora's digital box: Pix and pixels") hardly bears thinking on.

There are ways to cut down on the size; if you tar it all up and run [7-Zip](!Wikipedia) with maximum compression options, you could probably compact it to 1/5th the size. I found that the uncompressed files could be reduced by around 10% by using [fdupes](!Wikipedia) ([homepage](http://netdial.caribe.net/~adrian2/fdupes.html)) to, like [`freedup`](!Wikipedia "freedup"), look for duplicate files and turning the duplicates into a space-saving [hard link](!Wikipedia) to the original with a command like `fdupes --recurse --hardlink ~/www/`. (Apparently there are a *lot* of bit-identical JavaScript (eg. [JQuery](!Wikipedia)) and images out there.)

## Remote caching

We can ask a third party to keep a cache for us. The only three general [archive site](!Wikipedia) I know of are

1. the [Internet Archive](!Wikipedia)
2. [WebCite](!Wikipedia)
3. Linterweb's WikiWix^[Which I suspect is only accidentally 'general' and would shut down access if there were some other way to ensure that Wikipedia external links still got archived.].

There are other options but they are not available like Google^[Google Cache is generally recommended only as a last ditch resort because pages expire quickly from it. Personally, I'm convinced that Google would never just delete colossal amounts of Internet data - this is Google, after all, the epitome of storing unthinkable amounts of data - and that Google Cache merely ceases to make public its copies. And to request a Google spider visit, one has to solve a CAPTCHA - so that's not a scalable solution.] or various commercial/government archives^[Which obviously are not publicly accessible or submittable; I know they exist, but because they hide themselves, I know only from random comments online eg. ["years ago a friend of mine who I'd lost contact with caught up with me and told me he found a cached copy of a website I'd taken down in his employer's equivalent to the Wayback Machine. His employer was a branch of the federal government."](http://news.ycombinator.com/item?id=2880427).]

<!-- TODO: develop and cover Pinboard support; Maciej says such usage is acceptable - 'Your current archive size, growing at 20 GB a year, should not be a problem.  I'll put you on the heavy-duty server where my own stuff lives.' -->

(An example would be <http://bits.blogs.nytimes.com/2010/12/07/palm-is-far-from-game-over-says-former-chief/> being archived at <http://webcitation.org/5ur7ifr12>.)

My first program in this vein of thought was a bot which fired off WebCite and Internet Archive/Alexa requests: [Wikipedia Archiving Bot](haskell/Wikipedia Archive Bot), quickly followed up by a [RSS version](haskell/Wikipedia RSS Archive Bot). (Or you could install the [Alexa Toolbar](!Wikipedia) to get automatic submission to the Internet Archive, if you have ceased to care about privacy.)

The core code was quickly adapted into a [gitit](!Hackage) wiki plugin which hooked into the save-page functionality and tried to archive every link in the newly-modified page, [Interwiki.hs](https://github.com/jgm/gitit/blob/master/plugins/Interwiki.hs)

Finally, I wrote [archiver](!Hackage), a daemon which watches[^watch]/reads a text file. (Source is available via `darcs get http://community.haskell.org/~gwern/archiver/`.)

[^watch]: Version [0.1](http://hackage.haskell.org/package/archiver-0.1) of my `archiver` daemon didn't simply read the file until it was empty and exit, but actually watched it for modifications with [inotify](!Wikipedia). I removed this functionality when I realized that the required WebCite choking (just one URL every ~25 seconds) meant that `archiver` would *never* finish any reasonable workload.

The library half of `archiver` is a simple wrapper around the appropriate HTTP requests; the executable half reads a specified text file and loops as it (slowly) fires off requests and deletes the appropriate URL.

That is, `archiver` is a daemon which will process a specified text file, each line of which is a URL, and will one by one request that the URLs be archived or spidered

Usage of `archiver` might look like `archiver ~/.urls.txt gwern0@gmail.com`. In the past, `archiver` would sometimes crash for unknown reasons, so I usually wrap it in a `while` loop like so: `while true; do archiver ~/.urls.txt gwern0@gmail.com; done`. If I wanted to put it in a detached [GNU screen](!Wikipedia) session: `screen  -d -m -S "archiver" sh -c 'while true; do archiver ~/.urls.txt gwern0@gmail.com; done'`.

`archiver` has an extra feature where any third argument is treated as an arbitrary `sh` command to run after each URL is archived, to which is appended said URL. You might use this feature if you wanted to load each URL into Firefox, or append them to a log file, or simply download or archive the URL in some other way.

For example, in conjunction with the big _en masse_ `local-archiver` runs, I have `archiver` run `wget` on each individual URL: `screen  -d -m -S "archiver" sh -c 'while true; do archiver ~/.urls.txt gwern0@gmail.com "cd ~/www && wget --continue --page-requisites --timestamping -e robots=off --reject .iso,.exe,.gz,.xz,.rar,.7z,.tar,.bin,.zip,.jar,.flv,.mp4,.avi,.webm --user-agent='Firefox/3.5' 120"; done'`.

Alternately, you might use `curl` or a specialized archive downloader like the Internet Archive's crawler [Heritrix](http://crawler.archive.org/).

### URL sources

#### Browser history

There are a number of ways to populate the source text file. For example, I have a script `firefox-urls`:

~~~{.bash}
#!/bin/sh
set -e

cp --force `find ~/.mozilla/firefox/ -name "places.sqlite"|sort|head -1` ~/
sqlite3 -batch places.sqlite "SELECT url FROM moz_places, moz_historyvisits \
                       WHERE moz_places.id = moz_historyvisits.place_id and visit_date > strftime('%s','now','-1 day')*1000000 ORDER by \
                       visit_date;" | filter-urls
rm ~/places.sqlite
~~~

(`filter-urls` is the same script as in `local-archiver`. If I don't want a domain locally, I'm not going to bother with remote backups either. In fact, because of WebCite's rate-limiting, `archiver` is almost perpetually back-logged, and I *especially* don't want it wasting time on worthless links like [4chan](!Wikipedia).)

This is called every hour by `cron`:

~~~{.bash}
@hourly firefox-urls >> ~/.urls.txt
~~~

This gets all visited URLs in the last time period and prints them out to the file for archiver to process. Hence, everything I browse is backed-up through `archiver`.

#### Document links

More useful perhaps is a script to extract external links from Markdown files and print them to standard out: [link-extractor.hs](haskell/link-extractor.hs)

So now I can take `find . -name "*.page"`, pass the 100 or so Markdown files in my wiki as arguments, and add the thousand or so external links to the archiver queue (eg. `find . -name "*.page" -type f -print0 | xargs -0 runhaskell haskell/link-extractor.hs | filter-urls >> ~/.urls.txt`); they will eventually be archived/backed up.

#### Website spidering

Sometimes a particular website is of long-term interest to one even if one has not visited *every* page on it; one could manually visit them and rely on the previous Firefox script to dump the URLs into `archiver` but this isn't always practical or time-efficient. `linkchecker` inherently spiders the websites it is turned upon, so it's not a surprise that it can build a [site map](!Wikipedia) or simply spit out all URLs on a domain; unfortunately, while `linkchecker` has the ability to output in a remarkable variety of formats, it cannot simply output a newline-delimited list of URLs, so we need to post-process the output considerably. The following is the shell one-liner I use when I want to archive an entire site (note that this is a bad command to run on a large or heavily hyper-linked site like the English Wikipedia or [LessWrong](http://lesswrong.com)!); edit the target domain as necessary:

~~~{.bash}
nice linkchecker -odot --complete -v --ignore-url=^mailto --no-warnings http://www.longbets.org | fgrep http | fgrep -v -e "label=" -e "->" -e '" [' -e '" ]' -e "/ " | sed -e "s/href=\"//" -e "s/\",//" -e "s/ //" | filter-urls | sort --unique >> ~/.urls.txt
~~~

When `linkchecker` does not work, one alternative is to do a `wget --mirror` and extract the URLs from the filenames - list all the files and prefix with a "http://" etc.

# Reacting to broken links

`archiver` combined with a tool like `link-checker` means that there will rarely be any broken links on `gwern.net` since one can either find a live link or use the archived version. In theory, one has multiple options now:

0. Search for a copy on the live Web
1. link the Internet Archive copy
2. link the WebCite copy
3. link the WikiWix copy
4. use the `wget` dump

    If it's been turned into a full local file-based version with `--convert-links --page-requisites`, one can easily convert the dump into something like a standalone PDF suitable for public distribution. (A PDF is easier to store and link than the original directory of bits and pieces or other HTML formats like a ZIP archive of said directory.)

    I use [wkhtmltopdf](http://code.google.com/p/wkhtmltopdf/) which does a good job; an example of a dead webpage with no Internet mirrors is `http://www.aeiveos.com/~bradbury/MatrioshkaBrains/MatrioshkaBrainsPaper.html` which can be found at [1999-bradbury-matrioshkabrains.pdf](/docs/1999-bradbury-matrioshkabrains.pdf), or Sternberg et al's 2001 review ["The Predictive Value of IQ"](http://dl.dropbox.com/u/85192141/2001-sternberg.pdf).

# External links

- [Archive-It](http://www.archive-it.org/), Internet Archive
- [Pinboard](http://pinboard.in/)

    - ["Bookmark Archives That Don't"](http://blog.pinboard.in/2010/11/bookmark_archives_that_don_t/)
- ["Testing 3 million hyperlinks, lessons learned"](http://samsaffron.com/archive/2012/06/07/testing-3-million-hyperlinks-lessons-learned#comment-31366), Stack Exchange
- ["Backup All The Things"](http://muflax.com/software/backup/), muflax

# Appendices
## `filter-urls`

The following shell script is derived from manually filtering through several years of daily browsing as well as spiders of [dozens of websites](http://lesswrong.com/lw/7kg/rationalist_sites_worth_archiving/ "Rationalist sites worth archiving?") for various people & purposes; it removes many auto-generated pages like tags or comment URLs, as well as the obvious spam, drug, and porn links. This version is updated every 8 months.

~~~{.sh}
#!/bin/sh

# USAGE: `filter-urls` accepts on standard input a list of newline-delimited URLs or filenames,
# and emits on standard output a list of newline-delimited URLs or filenames. This list may be shorter and entries altered.
# It tries to remove all unwanted entries, where 'unwanted' is a highly idiosyncratic list of regexps and fixed-string matches
# developed over hundreds of thousands of URLs/filenames. You are advised to test output to make sure it does not remove
# URLs or filenames you want to keep. (An easy way to test what is removed is to use the `comm` utility.)
#
# For performance, it does not sort or uniquefy output, which can be done by piping `filter-urls` to `sort --unique`.

set -e

cat /dev/stdin | sed -e "s/#.*//" -e 's/>$//' -e "s/&sid=.*$//" -e "s/\/$//" -e 's/$/\n/' -e 's/\?sort=.*$//' \
    | grep "\." | fgrep -v "*" | egrep -v -e '\/\.rss$' -e "\.tw$" -e "//%20www\." -e "/file-not-found" \
    -e "258..\.com/$" -e "3qavdvd" -e "://avdvd" -e "\.avi" -e "\.com\.tw" \
    -e "\.onion" -e "\?fnid\=" -e "\?replytocom=" -e "^lesswrong.com/r/discussion/comments$" \
    -e "^lesswrong.com/user/gwern$" -e "^webcitation.org/query$" \
    -e "ftp.*" -e "6..6\.com" -e "6..9\.com" -e "6??6\.com" -e "7..7\.com" -e "7..8\.com" \
    -e "7..\.com" -e "78..\.com" -e "7??7\.com" -e "8..8\.com" -e "8??8\.com" -e "9..9\.com" \
    -e "9??9\.com" -e "aa-tw.com" -e "ca..\.38.*\.com" -e "lx...\.com" -e "www.bulk*" -e dm6.*\.com.cn -e gold.*sell -e vip.*club | \
    fgrep -v -e  174.143.149.98 -e "#!" -e "Special%3ASearch" -e "Special:Search" -e ".swf" -e "actress-av.com" \
    -e "alessonislearned.com/phpBB/faq.php?" -e "alessonislearned.com/phpBB/groupcp.php?" -e "alessonislearned.com/phpBB/images/avatars" \
    -e "alessonislearned.com/phpBB/images/smiles" -e "alessonislearned.com/phpBB/index.php?" -e "alessonislearned.com/phpBB/memberlist.php?" \
    -e "alessonislearned.com/phpBB/posting.php?" -e "alessonislearned.com/phpBB/profile.php?" -e "alessonislearned.com/phpBB/profilepic.php" \
    -e "alessonislearned.com/phpBB/rss" -e "alessonislearned.com/phpBB/tags.php" -e "alessonislearned.com/phpBB/templates" \
    -e "alessonislearned.com/phpBB/thread_lists" -e "alessonislearned.com/phpBB/viewforum.php?" \
    -e "alessonislearned.com/phpBB/viewonline.php" -e "althouse.blogspot.com" -e "animenewsnetwork.com/bbs/phpBB2/posting.php" \
    -e "animenewsnetwork.com/bbs/phpBB2/profile.php" -e "bit.ly" -e "digitalmusic" -e "e-cash6" \
    -e "evangelion-blog.blogspot" -e "experts-exchange" -e "file:/" -e "good.is" -e "haskell.org/haskellwiki" \
    -e "haskell.org/hoogle/?" -e "href=" -e "dl.dropbox.com/u/5317066/" -e "forum.evageeks.org/faq.php?" \
    -e "forum.evageeks.org/groupcp.php?" -e "forum.evageeks.org/images/avatars" -e "forum.evageeks.org/images/smiles" \
    -e "forum.evageeks.org/index.php?" -e "forum.evageeks.org/memberlist.php?" -e "forum.evageeks.org/posting.php?" \
    -e "forum.evageeks.org/profile.php?" -e "forum.evageeks.org/profilepic.php" -e "forum.evageeks.org/rss" \
    -e "forum.evageeks.org/tags.php" -e "forum.evageeks.org/templates" -e "forum.evageeks.org/thread_lists" \
    -e "forum.evageeks.org/viewforum.php?" -e "forum.evageeks.org/viewonline.php" -e "gainax.fr/faq.php?" \
    -e "gainax.fr/groupcp.php?" -e "gainax.fr/images/avatars" -e "gainax.fr/images/smiles" -e "gainax.fr/index.php?" \
    -e "gainax.fr/memberlist.php?" -e "gainax.fr/posting.php?" -e "gainax.fr/profile.php?" -e "gainax.fr/profilepic.php" \
    -e "gainax.fr/rss" -e "gainax.fr/tags.php" -e "gainax.fr/templates" -e "gainax.fr/thread_lists" \
    -e "gainax.fr/viewforum.php?" -e "gainax.fr/viewonline.php" -e "www.dropbox.com/home" -e "knowyourmeme" \
    -e "lesswrong.com/comments" -e "listserv.brown.edu" -e "miracle-fruit" -e "news.ycombinator.com/news" \
    -e "news.ycombinator.com/reply" -e "news.ycombinator.com/threads?id=gwern" -e "onemedstore" \
    -e "reddit.com/messages" -e "reddit.com/saved" -e "reddit.com/spoiler" -e "rit.edu" -e "seo-king" \
    -e "seo-pp" -e "starwars.wikia" -e "ups.com" -e "wow.*gold" -e "www.amazon.com" -e "www.blogger.com/comment" \
    -e "www.oktrans" -e "www.reddit.com/message" -e "www.seo2000" -e "www.show6" -e "www.tv.com" \
    -e "www.im.tv" -e '/?shared=email' -e '?like=1&_wpnonce' -e '?share=email' -e 'wp.me/' -e .rar \
    -e /keystamp= -e 080kiss -e 08go -e 0ck0.com/ -e 0ea0.com/ -e 0lv0.com/ -e 127.0 -e 168bank.com/ \
    -e 192.168 -e 1dollarscan.com/ -e 1x.com/ -e 3388mm -e 38gtv.com/ -e 3banana.com/ -e 420chan \
    -e 4chan -e 4nrx -e 523b8.com/ -e 533b8.com/ -e 69bits -e .bz2 -e .css -e .js -e .mov -e .mp3 \
    -e .tar.gz -e .tgz -e .zip -e abbywinters -e absoluteastronomy.com/ -e abughrai.be -e activedatax.com/ \
    -e actualtraffic -e ad-cdn.technoratimedia.com/ -e addons.mozilla -e adhs-chaoten.net -e adlog.com/ \
    -e adultnetservers -e airsealed -e aitsafe -e alexa.com/ -e alibaba -e allgametrade.com/ -e allsubs.org \
    -e allvoices -e alternet -e amateur -e amateurmovies -e amateurmovies -e amazon.co.uk -e amazon.com/ \
    -e amd.com/ -e americablog.com/ -e americommerce.com/ -e amorphia -e ani-manga -e anidb -e animeboards.com/ \
    -e animebyt -e animelyrics -e animemusic -e animenewsnetwork.com/survey/ -e animepaper.net \
    -e animesuki -e antiaging -e anymemo -e apache.com/ -e apnea -e apteka-drugstore -e archlinux \
    -e armani -e arto.com/ -e asuka-langley-sohryu -e automattic.com/ -e av.url.tw -e avline.tv \
    -e badongo -e baka -e bbb.org -e beautyzone -e bestbookstand -e bili.tv -e billboard.com/ -e biogenesis \
    -e bitsnoop -e bitty.com/ -e blinkbits.com/ -e blinklist.com/ -e blogger.com/ -e bloggingheads.tv/ \
    -e bloglines.com/ -e blogmarks -e blogmarks.com/ -e blogsuki -e blowjobs -e booksearch -e boxofficemojo \
    -e britannica.com/ -e bro-usa.com/ -e buttersafe -e buy69 -e buyativan -e buyephed -e buylortab \
    -e buypercocet -e cambridgebrainsciences.com/ -e care2.com/ -e casino -e caughtyou -e cdimage.debian \
    -e cdrking -e cgrascal -e chat-tw.com/ -e chi-us.com/ -e cmp3.net -e cmpmedica -e cmt.com/ \
    -e co.mments.com/ -e codeine -e concubine.com/ -e consumerrewards -e coolvibe.com/ -e coressl.jp \
    -e cornify -e coupon -e coupon -e craigslist -e credit-union.com/ -e crowdcast -e csslint -e current.com/ \
    -e cwb518.com/ -e cyberunique -e dailymanga -e dailytail -e danbooru -e darcswatch -e debian.org \
    -e delicious.com/ -e demonoid -e deposit -e designlessbetter -e desiredmeds -e detect.com/ \
    -e deviantart -e diazepam -e dictionary -e digg -e digg.com/submit -e diggstatic -e digitalpoint \
    -e diglog.com/ -e diigo.com/ -e discount-office -e discountlinux -e dlsite -e dobrochan.ru \
    -e docstoc -e domainnotfound -e domainnotfound.optimum -e donmai.us -e danbooru -e doom9 -e doorty.com/ \
    -e doubleclick -e doujin -e doujin-moe -e download.cnet.com/ -e downloadweb -e dragongoserver.net \
    -e dresspayless -e drugsaver -e e-mansion.com/ -e easy-share.com/ -e easylinux -e ebay -e ebookee \
    -e ecchiazu -e eda.com.tw -e egg168.com/ -e electronicsmanufacturer-china -e elegantsuccubus \
    -e elsevier.com/ -e encyclopediadramatica -e endlessvid -e ens888 -e epson.com/ -e erotic -e eroxia \
    -e evernote -e explosm -e f1fan -e facebook.com/ -e fakku.net -e fark.com/ -e fastclick -e faves.com/ \
    -e favicon.ico -e faysale -e fbcdn.net -e feedburner.com/ -e female-credit -e fengshui -e fifa \
    -e file770.com/ -e filefactory -e fileserve -e fileserve -e fileshare -e filesonic -e filestube \
    -e filext -e filmcritic -e flavorwire -e fleshlight -e flickr.com/ -e flixxy -e forum.fok.nl \
    -e forvault -e forvo.com/ -e free-credit -e freealbums -e freedomains4all -e freemusic -e freeones \
    -e frreeones -e ft.com/ -e furuhon-hiroba -e futuretimeline.net/forum/ -e g2gmart -e gabbr \
    -e gaia-online -e gamble -e gambling -e game4power -e gamelee -e gateway -e gawker -e gayo \
    -e gck99 -e gelbooru -e get.adobe.com/ -e getfirebug.com/ -e githits.me -e github.com/ -e gm.com/ \
    -e gmail -e gocomics -e gold007 -e goldenpalace -e goldmoney.com/ -e goo.gl -e google.com/ \
    -e google.ie -e googleapis.com/ -e googleusercontent -e grandpalace -e gravatar -e grooveshark \
    -e groups.google.com/ -e gteamtranslations -e guns.ru -e hackage -e hairshop -e hammurabi.acc. \
    -e happletea -e hashify.me -e hemidemi.com/ -e hentai -e herbaladvantage -e hilarypagetoys.com/ \
    -e hillaryclinton.com/ -e hitcounter -e hitsuyo -e hohotrade -e hollywoodreporter -e hongfire \
    -e hotfile -e hotfilesearch -e hotornot -e howto.com/ -e howtogeek.com/ -e hrblock -e gainax.fr/forum/ \
    -e newhouse -e www.futuretimeline.net/polls/ -e www.invisionpower.com/products/ -e www.khanacademy.org/video/ \
    -e www.macromedia.com/go/ -e www.nicovideo.jp/watch/ -e huffingtonpost.com/ -e hugedomains.com/ \
    -e hulu.com/ -e hustlercash -e i68.cc -e iagals.com/ -e icanhascheezburger.com/ -e icwutudidare \
    -e idolsgarden -e idv.tw -e ifile -e igarette -e iherb -e ikosubs -e imagebam -e imagemagick \
    -e imagevenue -e imdb.com/ -e imouto -e in199 -e ing199.net -e ingdirect -e investopedia.com/ \
    -e iqcomp -e iqdb.org -e irssi -e isfelicity -e isohunt -e itunes -e jamendo -e javjunkies \
    -e jetdl -e jewelry -e jizz -e joai -e jobs.rackspace.com/ -e jquery.js -e justin.tv -e karger \
    -e kfbank -e kingarthur -e kledy.de -e konachan -e koreanwiki -e last.fm -e lastpass -e lesswrong.com/search/ \
    -e levanquin -e lexico -e linkatopia -e linuxforums.org -e littlewhiteb -e liveglobalbid -e livejasmin \
    -e login -e login.yahoo.com/ -e logsoku -e londonriotmaps -e lorazepam -e lotro -e lovastatin \
    -e love520 -e lulu.com/ -e luxorcab -e lyrics -e macmillan -e macsales -e mail168 -e mailchimp.com/ \
    -e makeitmp3 -e mangafox -e mangahelpers -e mangareader -e mangarun -e mangastream -e maple-story \
    -e mapsofworld -e mcpac -e mediacdn.disqus -e mediafire -e mediaite.com/ -e meetup.com/ -e meetup.com/ \
    -e megaclick -e megarotic -e megashares -e megaupload -e memory-alpha -e merriam-webster -e mfcdn.net \
    -e milliways -e mininova -e mister-wong -e mixergy -e mmorpg.com/ -e modpath.com/ -e moekaku \
    -e moekaku -e monex -e moneygram -e mosha2 -e mozillaca.com/ -e mrtzc -e multiply.com/ -e myanimelist.net \
    -e myanimeshelf -e myass -e myfigurecollection.net -e mylinkvault -e mymmoshop -e myplasticheart \
    -e myspace -e myspace.com/ -e mysterysolved -e mywow -e nedroid -e nekomagic.com/ -e netvibes \
    -e netyouz -e newegg -e news.search.yahoo.com/ -e newsalloy.com/ -e newsgator.com/ -e newsgrounds \
    -e newstrust.net -e nicoviewer.net -e nicvape.com/ -e notfourchan.net -e nowpublic.com/ -e nubrain \
    -e nuklearpower.com/ -e nutrain -e nvhforum -e nyaa -e oglaf.com/ -e okciti.com/ -e omejo -e on-disk \
    -e onemanga.com/ -e opensearch.xml -e oppao.net -e optimum.net -e optimum.net -e oracle.com/ \
    -e orbitz -e oron.com/ -e osd.xml -e ostan -e otakulinks -e p.sf.net -e palada168 -e pandora.com/ \
    -e papayaone -e paste -e paypal.com/ -e petfinder -e pharmacy -e pharmland -e pheed -e phonak \
    -e phoronix -e picswan -e pinoyexchange.com/ -e piratebay -e pixiv -e plastic-mesh.com/ -e play-asia \
    -e playboy -e plurk.com/ -e pluschan.com/ -e popcon -e porn -e porn -e poseidon -e posting.php?mode=post \
    -e posting.php?mode=reply -e powel -e premierleague -e premiumgalleries -e primagames.com/ \
    -e printtix -e privmsg -e proquest -e public-api.wordpress.com/ -e pusha.se -e quality-rx -e quantserve.com/ \
    -e query.nytimes.com/ -e questmonk -e quickmeme.com/ -e quora -e rackspace.com/ -e raki-suta.com/ \
    -e rapidshare -e readitlater -e realmagick.com/ -e recipe -e reddit.com/ -e reddit.com/search \
    -e reddit.com/user/gwern/ -e redtube -e redwing -e reference.com/ -e rei-ayanami.com/ -e rei-ayanami.net \
    -e reiliberation -e rent-tw.com/ -e replica-live -e retailmenot -e retailmenot -e rich17 -e rightstuf \
    -e risette-translations -e rockymusic -e rsloads.com/ -e rt-nail-products -e runescape -e rxshop \
    -e ryuutama -e sagepub -e sahadou.com/ -e saymedia.com/ -e scorecardresearch -e scribd -e search.com/ \
    -e search.eb.com/ -e search.php -e sendori.com/ -e sendspace -e shadows-of-anubis -e sharebee \
    -e sharerimg -e sharethis -e shaylaren -e shoplinux -e shopper.cnet.com/ -e simexames.com/ \
    -e sitemeter.com/ -e siteshuffle.com/ -e skipscreen -e skydrive. -e sleepyfansscans -e smartpowders \
    -e smartpowders.com/ -e snipmp3.com/ -e soba-scans.com/ -e socialmedia -e socialmention -e socialmention \
    -e socialmention.com/ -e soeasy -e somethingawful -e sos-dan -e soundcloud.com/ -e sourcewatch \
    -e southwest -e sparkfun -e sparky.haskell.org -e springerlink.com/ -e stackexchange -e stackoverflow \
    -e startaid -e starwars -e stevenaitchison.co.uk -e stonybrook.edu -e stores.yahoo.net -e strands.com/ \
    -e stumble-upon -e stumbleupon -e subscene -e subscribe -e subscribe -e subtitle -e suffolk.lib.ny.us \
    -e suite101 -e sunysuffolk -e supanova -e surphace.com/ -e surveymon -e surveymonkey -e swingers \
    -e symbaloo -e tailrank.com/ -e tax.ny.gov -e tcgplayer.com/ -e teamskeet -e technotizie -e teesoft \
    -e tesuji.org -e thebiz8.com/ -e thecounter.com/ -e timeanddate -e tineye -e tinypic -e tinyurl \
    -e tjoos -e tk-nation.com/ -e topatoco -e torrent -e torrentz -e tube8 -e tumblr.com/ -e tvtropes \
    -e tvtropes -e tweetmeme.com/ -e twimg.com/ -e twitchfilm -e twitpic -e twitter.com/ -e twmail.net \
    -e ubuntuforums -e unitedpharm -e uploaded.to -e uploadstation -e ups.com/ -e usps.com/ -e uspto \
    -e viagra -e vimeo.com/ -e vk858 -e w3schools.com/ -e wakachan -e warhammer-sale -e webnews \
    -e webring -e websponsors -e websurvey -e wierdjapan -e wikimedia.org/ -e wikipedia.org/ -e wikiquote.org/ \
    -e wiktionary.org/ -e windows8center -e witcoin.com -e wn.com/ -e woot -e woot -e wordpress.com/category/ \
    -e wordpress.com/signup -e wordpress.com/tag/ -e wordsmith -e wow-power -e wp-comments-post.php \
    -e wp.com/wp-include -e wplogo.png -e wretch.cc -e wupload -e xanga -e xing.com/ -e xixidu.net/me/ \
    -e xmlrpc.php -e xvid -e yahoo -e yoolink -e youmob.com/ -e youtu.be -e youtube.com/ -e zalex \
    -e zerochan -e zombo -e zoombits -e blog.buzzflash.com/ -e .blogspot.com/search/ -e givewell.org/forward?path= \
    -e /image_captcha/ -e www.networkforgood.org/donate/ -e www.givewell.org/print/ -e www.edwardtufte.com/tufte/email?msg_id=  \
    -e www.adobe.com/products/ -e www.apple.com/ -e calendar.schemax.com/ -e www.edwardtufte.com/ecommerce/shopping-cart \
    -e gigapan.org/viewGigapanFullscreen.php -e activeanime.com/html/category/ -e sales.domcollect.com/ \
    -e www.eskimo.com/forbidden.html -e www.download4adollar.com/ -e www.visa.com/cgi-bin -e www.technorati.com/search/ \
    -e bloghop.com/ -e cvs.sourceforge.net -e lambda-the-ultimate.org/taxonomy/term/ -e technorati.com/search \
    -e www.bookfinder.com/ -e videobox.com/ -e thenude -e members.nearlyfreespeech.net -e filetram \
    -e altavistasports.com/ -e accuchiptiming.com/ -e fl.milesplit.com/ -e runningzone.com/ -e steepletiming.com/ \
    -e trihokie.smugmug.com/ -e www.active.com/ -e www.altavistasports.com/ -e www.coolrunning.com/ \
    -e www.disneyworldsports.com/ -e www.enduranceplanet.com/ -e www.epicsportsmarketing.com/ -e www.eteamz.com/ \
    -e www.eventmugshots.co -e www.evergladesultras.com/ -e www.fedsofbrevard.org -e www.fleetfeetorlando.com/ \
    -e www.icunphotos.com/ -e www.johnholmestrailrun.com/ -e www.johnholmestrailrun.com/ -e www.jtcrunning.com/ \
    -e www.leadvilletrail100.com/ -e www.multirace.com/ -e www.nyx.net/~mwallace/LT_files/Marathon/ \
    -e www.racesmith.com/ -e www.runnersdepotvb.com/ -e www.runnersworld.com/ -e www.runningzone.com/ \
    -e www.runtothesun4jeff.com/ -e www.spacecoastmarathon.com/ -e www.steepletiming.com/ -e www.trackshack.com/ \
    -e www.trihokie.com/ -e www.ultramarathonrunning.com/ -e www.ultrarunning.com/ -e www.ultrarunningmom.blogspot.com/ \
    -e www.uprunninginc.com/ -e www.walkjogrun.net -e www.whitedogvideos.com/ -e www.wildsideonline.net \
    -e www.wildsideonline.smugmug.com/ -e mikuchan -e robotvsbadger.com/ -e statcounter.com/ -e buy.com/ \
    -e dvdplanet.com/ -e www.jdoqocy.com/ -e cg-cm.blogspot.com/ -e imagehyper.com/ -e filesmore.com/ \
    -e toyasukaseries -e jennilee.com/ -e fileplanet.com/ -e bidsystem.com/ -e yobt.tv -e "/wiki/Special:Block/" \
    -e "/wiki/Special:WikiActivity" -e "/mediawiki/index.php?title=" -e animekida.com/ -e crusang.net \
    -e hellfireangels.com/ -e iiichan.net -e filesmonster.com/ -e dult-empire.com/ -e hootsuite.com/ \
    -e i.eho.st -e jennileeonline.com/ -e konashion.blogspot.com/ -e library.nu -e minus.com/ -e leagueoflegends.com/ \
    -e phapit.com/ -e rabbitrevelry.com/ -e 7chan.org -e reversegif.com/ -e kibitou4life.wordpress.com/ \
    -e teamvanilla.wordpress.com/ -e subimg.net -e outbrain.com/ -e hanyuu.net -e 18kintube.com/ \
    -e 2shared.com/ -e animekida.com/ -e gifsoup.com/ -e indiegogo.com/ -e twistys.com/ -e zettai-ryouiki.net \
    -e 66.228.44.62/ -e erogedownload.com/ -e igg.me -e jdownloader.org -e s2.subirimagenes.co \
    -e xbooru.com/ -e 4shared.com/ -e  memedepot.com/ -e adjuggler.net -e image.kz -e wrgroup.ru \
    -e wiki.lesswrong.com/wiki/Special: -e ul.to/ -e fb.me -e k.min.us -e ladygagatour.net -e www.askmen.com/sports/ \
    -e www.archive.org/index.php -e seeker.dice.com/ -e nicosound.anyap.info -e nicovideo.jp/watch \
    -e www.nicovideo.jp/search -e www.yourmorals.org/surveyresults_graph -e metabooru -e live.niconico.com/ \
    -e validator.w3.org -e www.etsy.com/ -e www.nicovideo.jp/tag/ -e lesswrong.com/tag/ -e www.overcomingbias.com/tag/ \
    -e www.makefoil.com/passwordXor.html -e goproblems.com/ -e community.wikia.com/ -e adblockplus.org \
    -e www.linkedin.com/reg/ -e www.linkedin.com/secure/ -e www.mcpl.lib.ny.us \
    -e www.smackjeeves.com/ -e www.pelleas.net/aniTOP/index.php?disp=msgform -e "www.pelleas.net/aniTOP/index.php?tempskin=_rss2" \
    -e www.pelleas.net/dbman/ -e "/search?q=cache:" -e b2evolution.net -e www.crunchyroll.com/user/ \
    -e www.gametrailers.com/ -e www.colorcombos.com/ -e "www.walla.co.il/" -e akiba-online.com/ \
    -e "vocaloid.wikia.com/index.php?" -e gamefaqs.com/boards/ -e www.gamefaqs.com/user -e lesswrong.com/edit/ \
    -e membership.gamefaqs.com/ -e chanarchive.org -e filepost.com/ -e chanarchive.org -e nh.web.id/tag \
    -e www.dropbox.com/revisions/ -e bugmenot.com/ -e krautchan.net -e bdnet.com/ -e datbtrue.co.uk \
    -e www.futuretimeline.net/search.htm -e rueducommerce -e 'www.squidge.org/~peja/' -e "mtgox.com" \
    -e "lnk.co/" -e 198.45.22.27 -e ebscohost.com/ -e sciencedirect.com/ -e psycnet.apa.org -e serialssolutions.com/ \
    -e webofknowledge.com/ -e 199.91.152.140 -e api.viglink.com/ -e gotupload.com/ -e resolver.lib.washington.edu \
    -e clipsite.com.ar -e download.ted.com/ -e koohii.com/ -e liargame.net -e yoroshii -e gen.lib.rus.ec \
    -e gigapedia.info -e mikudb.com/ -e mtgox.com/trade/ -e cablevision.com/ -e www.dropbox.com/account \
    -e veropedia -e www.goodjudgmentproject.com/ene/ -e "adf.ly/" -e animexx -e centrum-magi -e rediff.com/ \
    -e whatismyip.com/ -e ataku.tv -e manga.hu -e underarmour.com/ -e rule34.xxx -e .booru.org \
    -e smmry.com/ -e modalert.co -e goodjudgmentproject.com/ -e ptcmysore.gov.in -e onlinelibrary.wiley.com/ \
    -e webcitation.org/query -e texify.com/ -e slashdot.org/my/ -e worldcat.org -e lesswrong.com/message/ \
    -e loislaw.com/ -e test.personality-project.org -e livejournal.com/register -e livejournal.com/misc/ \
    -e livejournal.com/changeemail -e ".bin" -e linksysbycisco.com/ -e libgen.info -e shoprunner.com/ \
    -e techtarget.com/ -e camelegg.com/ -e head-fi.org -e eastview.com/ -e detexify -e img.free.fr \
    -e bandcamp.com/download -e tracfone.com/ -e boukenshin.net -e gptjob.com/ -e fileserving.com/ \
    -e foro.powers.cl -e mikubook.com/ -e downloadost.com/ -e filecrop.com/ -e lib.washington.edu/ \
    -e rs25.com/ -e uploadmirrors.com/ -e video.niconico.com/ -e feeds.wired.com/ -e rutracker.org/ \
    -e megashare.com/ -e nicovideo.jp/ -e omocat-shop.com/

# prevent URLs from piling up at the end of the file
echo ""
~~~

`filter-urls` can be used on one's local archive to save space by deleting files which may be downloaded by `wget` as dependencies. For example:

~~~{.sh}
find ~/www | sort --unique >> full.txt && \
    find ~/www | filter-urls | sort --unique >> trimmed.txt
comm -23 full.txt trimmed.txt | xargs -d "\n" rm
rm full.txt trimmed.txt
~~~

This shrunk my archive by 9GB from 65GB to 56GB, although at the cost of some archiving fidelity by removing many filetypes like CSS or JavaScript or GIF images.
